# TSX Files Compilation - Wed May 14 18:18:30 PDT 2025nThis file contains all .tsx files from the Chrome extension.nn// File: ./src/components/index-page.tsx
--------------------------------------------
import React, { useEffect, useState } from "react";
import "@/index.css";
import {
  PriceDatabase,
  type SiteRecord,
  type UserPreferences,
} from "../lib/storage";

// --- Header ---
function Header() {
  return (
    <header className="flex items-center justify-between mb-2">
      <div className="flex items-center">
        <img src="icons/logo.svg" alt="TFTC Logo" className="h-8 mr-2" />
        <span className="font-bold text-lg text-orange-500">
          Opportunity Cost
        </span>
      </div>
      <a
        href="options.html"
        target="_blank"
        rel="noopener noreferrer"
        className="text-xs text-gray-500 hover:underline"
      >
        Settings
      </a>
    </header>
  );
}

// --- Live Price ---
function LivePrice() {
  const [price, setPrice] = useState<number | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);
  const [currency, setCurrency] = useState("usd");

  const fetchPrice = async () => {
    setLoading(true);
    setError(null);
    try {
      const response = await new Promise<any>((resolve, reject) => {
        chrome.runtime.sendMessage(
          { action: "getBitcoinPrice" },
          (response) => {
            if (chrome.runtime.lastError) {
              reject(new Error(chrome.runtime.lastError.message));
            } else if (response?.error) {
              reject(new Error(response.error));
            } else {
              resolve(response);
            }
          }
        );
      });

      if (response?.price) {
        setPrice(response.price);
        setCurrency(response.currency || "usd");
        setLastUpdated(new Date());
      } else {
        throw new Error("Invalid price data received");
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : "Failed to fetch price");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchPrice();
  }, []);

  // Format currency symbol based on currency code
  const getCurrencySymbol = (currencyCode: string) => {
    switch (currencyCode.toLowerCase()) {
      case "usd":
        return "$";
      case "eur":
        return "€";
      case "gbp":
        return "£";
      default:
        return "$";
    }
  };

  return (
    <section className="mb-3">
      <div className="flex items-center justify-between">
        <span className="font-semibold">BTC Price:</span>
        {loading ? (
          <span className="text-lg font-mono text-gray-400">Loading...</span>
        ) : error ? (
          <span className="text-sm text-red-500">Error: {error}</span>
        ) : (
          <span className="text-lg font-mono">
            {getCurrencySymbol(currency)}
            {price?.toLocaleString(undefined, {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })}
          </span>
        )}
      </div>
      <div className="flex items-center justify-between text-xs text-gray-400 mt-1">
        <span>
          Last updated:{" "}
          {lastUpdated ? lastUpdated.toLocaleTimeString() : "--:--"}
        </span>
        <button
          className="hover:underline"
          onClick={fetchPrice}
          disabled={loading}
        >
          {loading ? "Refreshing..." : "Refresh"}
        </button>
      </div>
    </section>
  );
}

// --- Converter ---
function Converter() {
  const [fiatAmount, setFiatAmount] = useState<string>("");
  const [btcAmount, setBtcAmount] = useState<string>("");
  const [isReversed, setIsReversed] = useState(false);
  const [price, setPrice] = useState<number | null>(null);
  const [preferences, setPreferences] = useState<UserPreferences | null>(null);
  const [loading, setLoading] = useState(true);

  // Constants
  const SATS_IN_BTC = 100_000_000;

  useEffect(() => {
    // Fetch BTC price and preferences
    const fetchData = async () => {
      setLoading(true);
      try {
        // Get price and preferences
        const priceResponse = await new Promise<any>((resolve, reject) => {
          chrome.runtime.sendMessage(
            { action: "getBitcoinPrice" },
            (response) => {
              if (chrome.runtime.lastError) {
                reject(chrome.runtime.lastError);
              } else {
                resolve(response);
              }
            }
          );
        });

        setPrice(priceResponse?.price || null);

        // Get user preferences
        const prefsResponse = await new Promise<any>((resolve, reject) => {
          chrome.runtime.sendMessage(
            { action: "getPreferences" },
            (response) => {
              if (chrome.runtime.lastError) {
                reject(chrome.runtime.lastError);
              } else {
                resolve(response);
              }
            }
          );
        });

        if (prefsResponse?.preferences) {
          setPreferences(prefsResponse.preferences);
        }
      } catch (error) {
        console.error("Error fetching data:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  // Convert fiat to Bitcoin
  const convertFiatToBtc = (fiatValue: number): string => {
    if (!price) return "";

    const inBtc = fiatValue / price;

    // Format based on user preference (BTC or sats)
    if (preferences?.denomination === "sats") {
      const inSats = Math.round(inBtc * SATS_IN_BTC);
      return inSats.toLocaleString() + " sats";
    } else {
      // Format BTC with appropriate decimals
      if (inBtc < 0.000001) {
        return `${inBtc.toFixed(8)} BTC`;
      } else if (inBtc < 0.0001) {
        return `${inBtc.toFixed(6)} BTC`;
      } else {
        return `${inBtc.toFixed(5)} BTC`;
      }
    }
  };

  // Convert Bitcoin to fiat
  const convertBtcToFiat = (btcValue: number): string => {
    if (!price) return "";

    const inFiat = btcValue * price;
    const currencySymbol = getCurrencySymbol(
      preferences?.defaultCurrency || "usd"
    );

    return `${currencySymbol}${inFiat.toLocaleString(undefined, {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    })}`;
  };

  // Format currency symbol based on currency code
  const getCurrencySymbol = (currencyCode: string) => {
    switch (currencyCode.toLowerCase()) {
      case "usd":
        return "$";
      case "eur":
        return "€";
      case "gbp":
        return "£";
      default:
        return "$";
    }
  };

  // Handle fiat input change
  const handleFiatChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value;
    setFiatAmount(value);

    if (!isReversed && price) {
      try {
        const numValue = parseFloat(value);
        if (!isNaN(numValue)) {
          setBtcAmount(convertFiatToBtc(numValue));
        } else {
          setBtcAmount("");
        }
      } catch {
        setBtcAmount("");
      }
    }
  };

  // Handle BTC input change
  const handleBtcChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value;
    setBtcAmount(value);

    if (isReversed && price) {
      try {
        // Parse the input as BTC
        let numValue = parseFloat(value);

        // If in sats mode, convert sats to BTC first
        if (preferences?.denomination === "sats") {
          numValue = numValue / SATS_IN_BTC;
        }

        if (!isNaN(numValue)) {
          const fiatValue = (numValue * price).toFixed(2);
          setFiatAmount(fiatValue);
        } else {
          setFiatAmount("");
        }
      } catch {
        setFiatAmount("");
      }
    }
  };

  // Switch conversion direction
  const switchDirection = () => {
    setIsReversed(!isReversed);
    // Clear inputs on direction change
    setFiatAmount("");
    setBtcAmount("");
  };

  const currencyCode = preferences?.defaultCurrency?.toUpperCase() || "USD";
  const denomination = preferences?.denomination === "sats" ? "sats" : "BTC";

  return (
    <section className="mb-4">
      <div className="flex flex-col gap-2">
        {!isReversed ? (
          <>
            <input
              type="number"
              className="w-full p-2 border rounded"
              placeholder={`Enter amount (${currencyCode})`}
              value={fiatAmount}
              onChange={handleFiatChange}
              disabled={loading || !price}
            />
            <div className="flex items-center justify-between">
              <span className="text-xs text-gray-500">=</span>
              <span className="font-mono font-bold">{btcAmount}</span>
            </div>
          </>
        ) : (
          <>
            <input
              type="number"
              className="w-full p-2 border rounded"
              placeholder={`Enter amount (${denomination})`}
              value={btcAmount}
              onChange={handleBtcChange}
              disabled={loading || !price}
            />
            <div className="flex items-center justify-between">
              <span className="text-xs text-gray-500">=</span>
              <span className="font-mono font-bold">
                {fiatAmount
                  ? `${getCurrencySymbol(
                      preferences?.defaultCurrency || "usd"
                    )}${fiatAmount}`
                  : ""}
              </span>
            </div>
          </>
        )}
        <button
          className="text-xs text-blue-500 hover:underline self-end"
          onClick={switchDirection}
          disabled={loading}
        >
          Switch direction
        </button>
      </div>
    </section>
  );
}

// --- Recent Conversions ---
function RecentConversions() {
  const [sites, setSites] = useState<SiteRecord[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchConversions = async () => {
      setLoading(true);
      setError(null);
      try {
        const visited = await PriceDatabase.getVisitedSites();
        // Sort by timestamp descending, get the most recent 5
        visited.sort((a, b) => b.timestamp - a.timestamp);
        setSites(visited.slice(0, 5));
      } catch (err) {
        setError("Failed to load recent conversions");
        console.error("Error loading visited sites:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchConversions();
  }, []);

  const clearConversions = async () => {
    try {
      await PriceDatabase.db.clear("visitedSites");
      setSites([]);
    } catch (err) {
      setError("Failed to clear conversions");
      console.error("Error clearing sites:", err);
    }
  };

  // Format time ago from timestamp
  const timeAgo = (timestamp: number): string => {
    const seconds = Math.floor((Date.now() - timestamp) / 1000);

    if (seconds < 60) return `${seconds}s ago`;
    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
    return `${Math.floor(seconds / 86400)}d ago`;
  };

  // Format URL for display
  const formatUrl = (url: string): string => {
    try {
      const urlObj = new URL(url);
      return urlObj.hostname;
    } catch {
      return url;
    }
  };

  return (
    <section className="mb-4">
      <div className="font-semibold mb-1">Recent Conversions</div>
      {loading ? (
        <div className="text-xs text-gray-400">Loading conversions...</div>
      ) : error ? (
        <div className="text-xs text-red-500">{error}</div>
      ) : (
        <ul className="text-xs text-gray-700 space-y-1">
          {sites.length === 0 ? (
            <li>No recent conversions.</li>
          ) : (
            sites.map((site) => (
              <li key={site.url + site.timestamp}>
                {formatUrl(site.url)} - {site.conversionCount} conversions (
                {timeAgo(site.timestamp)})
              </li>
            ))
          )}
        </ul>
      )}
      <div className="flex justify-between mt-1">
        <button
          className="text-xs text-gray-400 hover:underline"
          onClick={clearConversions}
          disabled={loading || sites.length === 0}
        >
          Clear
        </button>
        <a
          href="options.html"
          target="_blank"
          rel="noopener noreferrer"
          className="text-xs text-blue-500 hover:underline"
        >
          More
        </a>
      </div>
    </section>
  );
}

// --- Quick Settings ---
function QuickSettings() {
  const [autoRefresh, setAutoRefresh] = useState(true);
  const [trackStats, setTrackStats] = useState(true);
  const [loading, setLoading] = useState(true);
  const [saveStatus, setSaveStatus] = useState<string | null>(null);

  useEffect(() => {
    const loadPreferences = async () => {
      setLoading(true);
      try {
        const preferences = await PriceDatabase.getPreferences();
        setAutoRefresh(preferences.autoRefresh !== false);
        setTrackStats(preferences.trackStats !== false);
      } catch (err) {
        console.error("Error loading preferences:", err);
      } finally {
        setLoading(false);
      }
    };

    loadPreferences();
  }, []);

  const handleAutoRefreshChange = async (
    e: React.ChangeEvent<HTMLInputElement>
  ) => {
    const checked = e.target.checked;
    setAutoRefresh(checked);

    try {
      await PriceDatabase.savePreferences({
        autoRefresh: checked,
      });
      chrome.runtime.sendMessage({ action: "preferencesUpdated" });
      setSaveStatus("Saved");
      setTimeout(() => setSaveStatus(null), 2000);
    } catch (err) {
      console.error("Error saving auto-refresh preference:", err);
      setSaveStatus("Failed to save");
      setTimeout(() => setSaveStatus(null), 2000);
    }
  };

  const handleTrackStatsChange = async (
    e: React.ChangeEvent<HTMLInputElement>
  ) => {
    const checked = e.target.checked;
    setTrackStats(checked);

    try {
      await PriceDatabase.savePreferences({
        trackStats: checked,
      });
      chrome.runtime.sendMessage({ action: "preferencesUpdated" });
      setSaveStatus("Saved");
      setTimeout(() => setSaveStatus(null), 2000);
    } catch (err) {
      console.error("Error saving track stats preference:", err);
      setSaveStatus("Failed to save");
      setTimeout(() => setSaveStatus(null), 2000);
    }
  };

  return (
    <section className="mb-4">
      <div className="flex flex-col gap-2">
        {loading ? (
          <div className="text-xs text-gray-400">Loading settings...</div>
        ) : (
          <>
            <label className="inline-flex items-center text-xs">
              <input
                type="checkbox"
                className="mr-2"
                checked={autoRefresh}
                onChange={handleAutoRefreshChange}
                disabled={loading}
              />
              Auto-refresh prices
            </label>
            <label className="inline-flex items-center text-xs">
              <input
                type="checkbox"
                className="mr-2"
                checked={trackStats}
                onChange={handleTrackStatsChange}
                disabled={loading}
              />
              Track conversion statistics
            </label>
            {saveStatus && (
              <div className="text-xs text-green-500">{saveStatus}</div>
            )}
          </>
        )}
      </div>
    </section>
  );
}

// --- Call To Action ---
function CallToAction() {
  return (
    <section className="mb-2 text-center">
      <a
        href="https://tftc.io/bitcoin-brief"
        target="_blank"
        rel="noopener noreferrer"
        className="inline-block bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold py-1 px-3 rounded"
      >
        Subscribe to Bitcoin Brief
      </a>
    </section>
  );
}

// --- Footer ---
function Footer() {
  return (
    <footer className="text-center text-xs text-gray-400 mt-2">
      <span>
        &copy; 2025 Opportunity Cost &middot; Powered by{" "}
        <a
          href="https://tftc.io"
          target="_blank"
          rel="noopener noreferrer"
          className="hover:underline text-gray-500"
        >
          TFTC
        </a>
      </span>
    </footer>
  );
}

// --- Main IndexPage ---
export function IndexPage() {
  return (
    <div className="w-80 p-4 bg-white min-h-screen font-sans">
      <Header />
      <LivePrice />
      <Converter />
      <RecentConversions />
      <QuickSettings />
      <CallToAction />
      <Footer />
    </div>
  );
}



// File: ./src/components/options-page.tsx
--------------------------------------------
import { useEffect, useState } from "react";
import {
  PriceDatabase,
  type PriceRecord,
  type SiteRecord,
} from "../lib/storage";

export function OptionsPage() {
  // State for form fields
  const [defaultCurrency, setDefaultCurrency] = useState("usd");
  const [displayMode, setDisplayMode] = useState<
    "bitcoin-only" | "dual-display"
  >("dual-display");
  const [denomination, setDenomination] = useState<"btc" | "sats">("btc");
  const [autoRefresh, setAutoRefresh] = useState(true);
  const [trackStats, setTrackStats] = useState(true);
  const [saveMessage, setSaveMessage] = useState(false);
  const [loadingSettings, setLoadingSettings] = useState(true);
  const [settingsError, setSettingsError] = useState<string | null>(null);

  // Price history state
  const [priceHistory, setPriceHistory] = useState<PriceRecord[]>([]);
  const [loadingHistory, setLoadingHistory] = useState(true);
  const [historyError, setHistoryError] = useState<string | null>(null);

  // Visited sites state
  const [sites, setSites] = useState<SiteRecord[]>([]);
  const [loadingSites, setLoadingSites] = useState(true);
  const [sitesError, setSitesError] = useState<string | null>(null);

  // Load settings on mount
  useEffect(() => {
    async function loadSettings() {
      setLoadingSettings(true);
      setSettingsError(null);
      try {
        const preferences = await PriceDatabase.getPreferences();
        setDefaultCurrency(preferences.defaultCurrency || "usd");
        setDisplayMode(preferences.displayMode || "dual-display");
        setDenomination(preferences.denomination || "btc");
        setAutoRefresh(preferences.autoRefresh !== false); // default true
        setTrackStats(preferences.trackStats !== false); // default true
      } catch {
        setSettingsError("Error loading settings");
      } finally {
        setLoadingSettings(false);
      }
    }
    loadSettings();
  }, []);

  // Load price history on mount
  useEffect(() => {
    async function loadPriceHistory() {
      setLoadingHistory(true);
      setHistoryError(null);
      try {
        const endTime = Date.now();
        const startTime = endTime - 7 * 24 * 60 * 60 * 1000; // 7 days
        const history = await PriceDatabase.getPriceHistory(
          "usd",
          startTime,
          endTime
        );
        // Sort by timestamp descending, show up to 10
        history.sort(
          (a: PriceRecord, b: PriceRecord) => b.timestamp - a.timestamp
        );
        setPriceHistory(history.slice(0, 10));
      } catch {
        setHistoryError("Error loading price history");
      } finally {
        setLoadingHistory(false);
      }
    }
    loadPriceHistory();
  }, []);

  // Load visited sites on mount
  useEffect(() => {
    async function loadVisitedSites() {
      setLoadingSites(true);
      setSitesError(null);
      try {
        const visited = await PriceDatabase.getVisitedSites();
        visited.sort(
          (a: SiteRecord, b: SiteRecord) => b.timestamp - a.timestamp
        );
        setSites(visited);
      } catch {
        setSitesError("Error loading visited sites");
      } finally {
        setLoadingSites(false);
      }
    }
    loadVisitedSites();
  }, []);

  // Handle form submit
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await PriceDatabase.savePreferences({
        defaultCurrency,
        displayMode,
        denomination,
        autoRefresh,
        trackStats,
      });
      // Notify background script that preferences have been updated
      chrome.runtime.sendMessage({ action: "preferencesUpdated" });
      setSaveMessage(true);
      setTimeout(() => setSaveMessage(false), 2000);
    } catch {
      alert("There was an error saving your settings. Please try again.");
    }
  };

  // Handle clear data
  const handleClearData = async () => {
    if (
      !window.confirm(
        "Are you sure you want to clear all saved data? This action cannot be undone."
      )
    )
      return;
    try {
      await PriceDatabase.db.clear("priceHistory");
      await PriceDatabase.db.clear("visitedSites");
      await PriceDatabase.savePreferences({
        id: "user-preferences",
        defaultCurrency: "usd",
        displayMode: "dual-display",
        denomination: "btc",
        autoRefresh: true,
        trackStats: true,
        lastUpdated: Date.now(),
      });
      // Reload all data
      window.location.reload();
    } catch {
      alert("There was an error clearing the data. Please try again.");
    }
  };

  return (
    <div className="max-w-3xl mx-auto p-6 text-gray-800 bg-gray-50 min-h-screen">
      <div className="flex items-center justify-between mb-6">
        <div className="flex items-center">
          <img src="icons/logo.svg" alt="TFTC Logo" className="h-10 mr-4" />
          <h1 className="text-xl font-bold text-gray-900">Opportunity Cost</h1>
        </div>
      </div>

      <div className="bg-white rounded-lg p-6 mb-6 shadow">
        <h2 className="text-xl font-semibold mb-4">Settings</h2>
        {loadingSettings ? (
          <div className="text-gray-400">Loading settings...</div>
        ) : settingsError ? (
          <div className="text-red-500">{settingsError}</div>
        ) : (
          <form id="settings-form" onSubmit={handleSubmit}>
            <div className="mb-4">
              <label
                htmlFor="default-currency"
                className="block mb-2 font-bold"
              >
                Default Currency:
              </label>
              <select
                id="default-currency"
                name="defaultCurrency"
                className="w-full p-2 rounded border border-gray-300"
                value={defaultCurrency}
                onChange={(e) => setDefaultCurrency(e.target.value)}
              >
                <option value="usd">US Dollar (USD)</option>
                <option value="eur" disabled>
                  Euro (EUR) - Coming Soon
                </option>
                <option value="gbp" disabled>
                  British Pound (GBP) - Coming Soon
                </option>
                <option value="jpy" disabled>
                  Japanese Yen (JPY) - Coming Soon
                </option>
              </select>
            </div>

            <div className="mb-4">
              <label htmlFor="denomination" className="block mb-2 font-bold">
                Bitcoin Denomination:
              </label>
              <p className="text-sm text-gray-600 mb-2">
                Choose how Bitcoin amounts are displayed. Example: (100 sats |
                $1) or (1 BTC | $100k)
              </p>
              <select
                id="denomination"
                name="denomination"
                className="w-full p-2 rounded border border-gray-300"
                value={denomination}
                onChange={(e) =>
                  setDenomination(e.target.value as "btc" | "sats")
                }
              >
                <option value="sats">Satoshis (sats)</option>
                <option value="btc">Bitcoin (BTC)</option>
              </select>
            </div>

            <div className="mb-4">
              <label htmlFor="display-mode" className="block mb-2 font-bold">
                Display Mode:
              </label>
              <select
                id="display-mode"
                name="displayMode"
                className="w-full p-2 rounded border border-gray-300"
                value={displayMode}
                onChange={(e) =>
                  setDisplayMode(
                    e.target.value as "bitcoin-only" | "dual-display"
                  )
                }
              >
                <option value="dual-display">
                  Dual Display (Fiat | {denomination === "btc" ? "BTC" : "sats"}
                  )
                </option>
                <option value="bitcoin-only">
                  {denomination === "btc" ? "Bitcoin" : "Satoshis"} Only
                </option>
              </select>
            </div>

            <div className="mb-4">
              <label className="inline-flex items-center font-bold">
                <input
                  type="checkbox"
                  id="auto-refresh"
                  name="autoRefresh"
                  className="mr-2"
                  checked={autoRefresh}
                  onChange={(e) => setAutoRefresh(e.target.checked)}
                />
                Auto-refresh prices every 15 minutes
              </label>
            </div>

            <div className="mb-4">
              <label className="inline-flex items-center font-bold">
                <input
                  type="checkbox"
                  id="track-stats"
                  name="trackStats"
                  className="mr-2"
                  checked={trackStats}
                  onChange={(e) => setTrackStats(e.target.checked)}
                />
                Track conversion statistics
              </label>
            </div>

            <button
              type="submit"
              className="bg-orange-500 hover:bg-orange-600 cursor-pointer text-white font-bold py-2 px-4 rounded mt-2"
            >
              Save Settings
            </button>
            {saveMessage && (
              <span className="text-green-600 font-bold ml-4">
                Settings saved!
              </span>
            )}
          </form>
        )}
      </div>

      <div className="bg-gray-100 border border-gray-200 rounded-lg p-6 mt-8 text-center">
        <h3 className="text-lg font-semibold mb-2">
          Stay Updated with Bitcoin News
        </h3>
        <p className="mb-4">
          Subscribe to the Bitcoin Brief newsletter from TFTC to get the latest
          Bitcoin updates, market analysis, and insights delivered to your
          inbox.
        </p>
        <a
          href="https://tftc.io/bitcoin-brief?utm_source=opportunity-cost-extension"
          target="_blank"
          rel="noopener noreferrer"
          className="bg-black hover:bg-gray-800 text-white font-bold py-3 px-6 rounded inline-block"
        >
          Subscribe to Bitcoin Brief
        </a>
      </div>

      <div className="bg-white rounded-lg p-6 my-6 shadow">
        <h2 className="text-xl font-semibold mb-4">Price History</h2>
        {loadingHistory ? (
          <div className="text-gray-400">Loading price history data...</div>
        ) : historyError ? (
          <div className="text-red-500">{historyError}</div>
        ) : priceHistory.length === 0 ? (
          <div className="empty-state">
            No price history data available yet. The extension will collect data
            as you browse.
          </div>
        ) : (
          <table className="min-w-full border border-gray-200">
            <thead>
              <tr>
                <th className="bg-gray-100 px-4 py-2 border-b">Date</th>
                <th className="bg-gray-100 px-4 py-2 border-b">Time</th>
                <th className="bg-gray-100 px-4 py-2 border-b">
                  BTC Price (USD)
                </th>
              </tr>
            </thead>
            <tbody>
              {priceHistory.map((entry, idx) => {
                const date = new Date(entry.timestamp);
                return (
                  <tr
                    key={entry.timestamp}
                    className={idx % 2 === 0 ? "bg-gray-50" : ""}
                  >
                    <td className="px-4 py-2 border-b">
                      {date.toLocaleDateString()}
                    </td>
                    <td className="px-4 py-2 border-b">
                      {date.toLocaleTimeString()}
                    </td>
                    <td className="px-4 py-2 border-b">
                      $
                      {entry.price.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                      })}
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        )}
      </div>

      <div className="bg-white rounded-lg p-6 mb-6 shadow">
        <h2 className="text-xl font-semibold mb-4">Visited Sites Statistics</h2>
        <div className="overflow-x-auto">
          <p className="mb-2">
            Sites where Opportunity Cost has converted prices:
          </p>
          {loadingSites ? (
            <div className="text-gray-400">Loading visited sites...</div>
          ) : sitesError ? (
            <div className="text-red-500">{sitesError}</div>
          ) : (
            <table className="min-w-full border border-gray-200">
              <thead>
                <tr>
                  <th className="bg-gray-100 px-4 py-2 border-b">Website</th>
                  <th className="bg-gray-100 px-4 py-2 border-b">Last Visit</th>
                  <th className="bg-gray-100 px-4 py-2 border-b">
                    Conversions
                  </th>
                </tr>
              </thead>
              <tbody>
                {sites.length === 0 ? (
                  <tr>
                    <td colSpan={3} className="text-center text-gray-400 py-8">
                      No data available.
                    </td>
                  </tr>
                ) : (
                  sites.map((site: SiteRecord, idx: number) => {
                    let displayUrl = site.url;
                    try {
                      const urlObj = new URL(site.url);
                      displayUrl =
                        urlObj.hostname +
                        (urlObj.pathname !== "/" ? urlObj.pathname : "");
                    } catch {
                      // console.error("Error parsing URL:", site.url);
                    }
                    const date = new Date(site.timestamp);
                    return (
                      <tr
                        key={site.url + site.timestamp}
                        className={idx % 2 === 0 ? "bg-gray-50" : ""}
                      >
                        <td className="px-4 py-2 border-b">{displayUrl}</td>
                        <td className="px-4 py-2 border-b">
                          {date.toLocaleDateString()}{" "}
                          {date.toLocaleTimeString()}
                        </td>
                        <td className="px-4 py-2 border-b">
                          {site.conversionCount}
                        </td>
                      </tr>
                    );
                  })
                )}
              </tbody>
            </table>
          )}
        </div>
        <button
          onClick={handleClearData}
          className="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mt-4"
        >
          Clear All Data
        </button>
      </div>

      <div className="mt-10 text-center text-gray-500 text-sm">
        <p>
          Opportunity Cost Extension &copy; 2025 | Powered by{" "}
          <a
            href="https://tftc.io"
            target="_blank"
            rel="noopener noreferrer"
            className="text-gray-700 hover:underline"
          >
            Truth For The Commoner (TFTC)
          </a>
        </p>
      </div>
    </div>
  );
}



// File: ./src/index.tsx
--------------------------------------------
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import "@/index.css";
import { IndexPage } from "@/components/index-page";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <IndexPage />
  </StrictMode>
);



// File: ./src/options.tsx
--------------------------------------------
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import "./index.css";
import { OptionsPage } from "./components/options-page";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <OptionsPage />
  </StrictMode>
);



